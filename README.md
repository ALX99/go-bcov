# go-bcov

<p align="center">
  <img src="https://github.com/ALX99/go-bcov/blob/main/logo.png" />
</p>

`go-bcov` is a tool to calculate branch coverage from Go coverage reports.

It works by parsing the coverage file generated by go to understand which lines have
been covered, and then concurrently parses the AST to understand which branches
have been covered. Both `if` and `switch` statements are supported.

The coverage file is read from standard input and the report is generated to standard output.

## Installation

```bash
go install github.com/alx99/go-bcov@v1
```

## Usage

### Sonarqube coverage report

```bash
go test -coverprofile=coverage.out -covermode count ./...
go-bcov -format sonar-cover-report < coverage.out > coverage.xml

# and upload...
sonar-scanner-cli \
    -Dsonar.sources=. -Dsonar.exclusions=**/*_test.go,**/*_mock.go \
    -Dsonar.tests=. -Dsonar.test.inclusions=**/*_test.go \
    -Dsonar.coverageReportPaths=coverage.xml -Dsonar.go.coverage.reportPaths=coverage.txt
```

## Supported output formats

- [Sonarqube generic coverage report](https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/test-coverage/generic-test-data/)
  - Both line and branch coverage are supported.

